<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lindy Hop & Boogie Woogie Figures</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Include Papa Parse via CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    /* Dark Mode Styling */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #121212;
      color: #e0e0e0;
    }
    header {
      background-color: #222;
      color: #fff;
      padding: 10px;
      text-align: center;
    }
    .filter-controls {
      background: #333;
      padding: 10px;
      color: #fff;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    .filter-group {
      margin: 0 10px;
    }
    .filter-group span {
      margin-right: 5px;
      font-weight: bold;
    }
    .filter-group label {
      margin-right: 8px;
      cursor: pointer;
    }
    /* Accordion container: center and limit width on larger screens */
    .accordion {
      max-width: 600px;
      margin: 20px auto;
      width: 100%;
      padding: 0 10px;
    }
    /* Accordion styles */
    .accordion-item {
      background: #1e1e1e;
      border-radius: 4px;
      margin-bottom: 10px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    .accordion-header {
      padding: 10px;
      cursor: pointer;
      background: #2a2a2a;
      user-select: none;
      color: #fff;
    }
    .accordion-content {
      display: none;
      padding: 10px;
      border-top: 1px solid #444;
      background: #1e1e1e;
    }
    .accordion-item.active .accordion-content {
      display: block;
    }
    video {
      width: 100%;
      border-radius: 4px;
      margin-bottom: 10px;
    }
    /* Responsive design for mobile */
    @media (max-width: 600px) {
      .accordion {
        margin: 20px 10px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Lindy Hop & Boogie Woogie Figures</h1>
  </header>
  
  <!-- Checkbox filters -->
  <div class="filter-controls">
    <div class="filter-group" id="tempiFilterGroup">
      <span>Tempi:</span>
      <label><input type="checkbox" value="6">6</label>
      <label><input type="checkbox" value="8">8</label>
      <label><input type="checkbox" value="10">10</label>
      <label><input type="checkbox" value="12">12</label>
    </div>
    <div class="filter-group" id="stileFilterGroup">
      <span>Stile:</span>
      <label><input type="checkbox" value="passo base">Passo Base</label>
      <label><input type="checkbox" value="aperta">Aperta</label>
    </div>
    <div class="filter-group" id="presaFilterGroup">
      <span>Presa:</span>
      <label><input type="checkbox" value="contraria">Contraria</label>
      <label><input type="checkbox" value="doppia">Doppia</label>
      <label><input type="checkbox" value="normale">Normale</label>
    </div>
  </div>
  
  <!-- Accordion container -->
  <main>
    <div class="accordion" id="accordionContainer">
      <!-- Accordion items will be generated here -->
    </div>
  </main>
  
  <script>
    let figures = []; // This will hold our parsed CSV data
    let currentActiveItem = null; // Track the currently open accordion item

    // Function to create and display accordion items in CSV order
    function displayAccordion(figureList) {
      const container = document.getElementById('accordionContainer');
      container.innerHTML = ''; // Clear previous content

      if (figureList.length === 0) {
        container.innerHTML = '<p>No figures match the selected filters.</p>';
        return;
      }

      figureList.forEach(figure => {
        // Create the accordion item container
        const item = document.createElement('div');
        item.className = 'accordion-item';

        // Create the header (always visible)
        const header = document.createElement('div');
        header.className = 'accordion-header';
        header.textContent = figure.Figura;
        header.addEventListener('click', () => {
          // If there's a currently active item (and it's not the one clicked), collapse it and pause its video.
          if (currentActiveItem && currentActiveItem !== item) {
            const oldVideo = currentActiveItem.querySelector('video');
            if (oldVideo) {
              oldVideo.pause();
            }
            currentActiveItem.classList.remove('active');
          }
          // Determine if we're expanding this item.
          const isExpanding = !item.classList.contains('active');
          // Toggle this item's active state.
          item.classList.toggle('active');
          currentActiveItem = item.classList.contains('active') ? item : null;
          
          // Play or pause the video as needed.
          const videoEl = item.querySelector('video');
          if (videoEl) {
            if (isExpanding) {
              videoEl.play();
            } else {
              videoEl.pause();
            }
          }
        });
        item.appendChild(header);

        // Create the content section (hidden by default)
        const content = document.createElement('div');
        content.className = 'accordion-content';
        content.innerHTML = `
          <video src="video/${figure.Video}.mp4" loop muted playsinline></video>
          <p><strong>Tempi:</strong> ${figure.Tempi}</p>
          <p><strong>Stile:</strong> ${figure.Stile}</p>
          <p><strong>Presa:</strong> ${figure.Presa}</p>
        `;
        item.appendChild(content);

        // Append the accordion item to the container
        container.appendChild(item);
      });
    }

    // Helper: Get selected values from a filter group by its container ID
    function getSelectedValues(groupId) {
      const checkboxes = document.querySelectorAll(`#${groupId} input[type="checkbox"]`);
      return Array.from(checkboxes)
                  .filter(cb => cb.checked)
                  .map(cb => cb.value);
    }

    // Function to filter figures based on multiple checkbox filters
    function filterFigures() {
      const selectedTempi = getSelectedValues('tempiFilterGroup');
      const selectedStile = getSelectedValues('stileFilterGroup');
      const selectedPresa = getSelectedValues('presaFilterGroup');

      const filteredFigures = figures.filter(figure => {
        // For each group, if no checkbox is selected then accept all values,
        // otherwise check if the figure's value is in the selected list.
        const tempiMatch = selectedTempi.length === 0 || selectedTempi.includes(figure.Tempi.trim());
        const stileMatch = selectedStile.length === 0 || selectedStile.includes(figure.Stile.trim().toLowerCase());
        const presaMatch = selectedPresa.length === 0 || selectedPresa.includes(figure.Presa.trim().toLowerCase());
        return tempiMatch && stileMatch && presaMatch;
      });

      displayAccordion(filteredFigures);
    }

    // Add event listeners to all filter checkboxes
    document.querySelectorAll('.filter-controls input[type="checkbox"]').forEach(cb => {
      cb.addEventListener('change', filterFigures);
    });

    // Fetch the CSV file from the repository and parse it
    fetch('lista_figure.csv')
      .then(response => response.text())
      .then(csvText => {
        const results = Papa.parse(csvText, { header: true, skipEmptyLines: true });
        figures = results.data;

        // Normalize text values
        figures.forEach(item => {
          item.Tempi = item.Tempi.trim();
          item.Stile = item.Stile.trim().toLowerCase();
          item.Presa = item.Presa.trim().toLowerCase();
        });

        // Initially display all figures in CSV order
        displayAccordion(figures);
      })
      .catch(error => console.error("Error loading CSV file:", error));
  </script>
</body>
</html>
